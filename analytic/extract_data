# Install firebase lib.
# pip install firebase-admin 

import json
import firebase_admin
from firebase_admin import credentials, db

# Key
service_account_path = r"tic-tac-toe-testing-env-firebase-adminsdk-fbsvc-a4a6be42e7.json" # TOKEN ACCESS DATA BASE

if not firebase_admin._apps:
    cred = credentials.Certificate(service_account_path)
    firebase_admin.initialize_app(cred, {
        "databaseURL": "https://tic-tac-toe-testing-env-default-rtdb.firebaseio.com/" #URL DATA_BASE
    })

def extract_fields(record):
    return {
        "session_id": record.get("session", {}).get("id"),
        "session_mode": record.get("session", {}).get("mode"),
        "question_correct": record.get("question", {}).get("correct"),
        "question_id": record.get("question", {}).get("id"),
        "event_duration": record.get("event", {}).get("duration"),
        "user_id": record.get("user", {}).get("id"),
        "timestamp": record.get("@timestamp"),
        "question_selected": record.get("question", {}).get("selected")
    }

def main(output_path="ccna-vp-export-lines.json"):
    ref = db.reference("userLogs")
    data = ref.get()

    with open(output_path, "w", encoding="utf-8") as out:
        for user_logs in data.values():
            for log in user_logs.values():
                registro = extract_fields(log)
                out.write(json.dumps(registro, ensure_ascii=False) + "\n")

if __name__ == "__main__":
    main()
